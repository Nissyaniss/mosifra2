{% extends "base.html" %}
{% load static %}

<!-- page de validation du code a2f envoyé par mail -->
{% block content %}
  <div class="w-[100vw] ml-[calc(50%-50vw)]">
    <section class="bg-brand-surface border-y border-[#cfdffc]" style="padding: 2.5rem 0;">
      <div class="max-w-6xl mx-auto px-4 sm:px-10 text-center">
        <h1 class="text-[2.25rem] md:text-[3rem] font-normal text-slate-900">Dernière étape - authentification à deux facteurs</h1>
      </div>
    </section>

    <div class="max-w-3xl mx-auto px-4 mt-12 text-center space-y-10">
      <p
        class="mx-auto max-w-xl px-8 py-4 text-sm md:text-base leading-relaxed text-black shadow-sm"
        style="background-color:#d9d9d9;border-radius:24px;"
      >
        Nous avons envoyé un code à <strong>{{ target_email|default:"ton email" }}</strong>.
        <span class="block mt-1 text-sm text-black">Il expire dans 10 minutes. Entre-le ci-dessous pour finaliser ta connexion.</span>
      </p>

      <div class="pt-6" style="padding-bottom:18px;">
        <div
          class="mx-auto"
          style="height:1px;width:90%;max-width:720px;background-color:#000;opacity:0.8;"
        ></div>
      </div>

      <form method="post" class="space-y-8 max-w-md mx-auto text-left">
        {% csrf_token %}
        <div class="space-y-3 text-center mb-10">
          {% if form.non_field_errors %}
            <div class="rounded-2xl border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700 mb-4">
              {{ form.non_field_errors }}
            </div>
          {% endif %}

          <div class="relative flex justify-center">
            {{ form.code }}
          </div>
          {% if form.code.errors %}
            <ul class="text-sm font-medium text-red-600">
              {% for error in form.code.errors %}
                <li>{{ error }}</li>
              {% endfor %}
            </ul>
          {% endif %}
          {% if messages %}
            {% for message in messages %}
              {% if message.tags == 'error' %}
                <p class="text-sm font-medium text-red-600">{{ message }}</p>
              {% endif %}
            {% endfor %}
          {% endif %}
        </div>

        <div class="space-y-3 text-center mt-10">
          <button
            type="submit"
            class="mx-auto inline-flex items-center justify-center px-8 py-2 rounded-md bg-brand-primary text-white text-lg hover:bg-brand-primaryDark transition shadow-sm"
          >
            Valider le code
          </button>
          <p class="text-sm text-slate-600">
            Pas reçu le code ?
            <!-- bouton pour renvoyer le code sans valider le formulaire -->
            <button
              type="submit"
              name="resend_code"
              value="1"
              formnovalidate
              class="inline-flex items-center font-semibold text-brand-primary hover:underline"
            >
              Renvoyer le code
            </button>
          </p>
        </div>
      </form>
    </div>
  </div>
{% endblock %}
